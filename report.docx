
Outline

The Clinic Appointment Manager is a web application that allows patients to book, view, and search for appointments at a clinic. It also includes a user authentication system for staff members, tracking login attempts in an audit log. The application is built using Node.js with Express as the web framework, MySQL for the database, and EJS for server-side templates. Users can submit appointment requests via forms, while staff can manage users and view logs of login activity.

---

Architecture

Technologies & Components:

* Application tier: Node.js, Express, EJS templates, bcrypt for password hashing
* Data tier: MySQL database with tables for `appointments`, `users`, and `login_audit`

High-level Architecture Diagram:




Data Model

The database has three main tables:

1. appointments – Stores patient appointments (id, name, email, date, time, created_at)
2. users – Stores staff user accounts (id, username, first, last, email, hashedPassword, created_at)
3. login_audit – Logs login attempts (id, username, login_time, success, ip_address)

Data Model Diagram:

```
users
 ├─ id (PK)
 ├─ username
 ├─ first
 ├─ last
 ├─ email
 ├─ hashedPassword
 └─ created_at

appointments
 ├─ id (PK)
 ├─ name
 ├─ email
 ├─ date
 ├─ time
 └─ created_at

login_audit
 ├─ id (PK)
 ├─ username
 ├─ login_time
 ├─ success
 └─ ip_address
```

---

User Functionality

1. Book Appointment – Users fill a form (`/appointments/book`) with name, email, date, and time. On submission, the appointment is stored in the database.
2. List Appointments – Users or staff can view all appointments (`/appointments/list`) in a table sorted by date and time.
3. Search Appointments – Users can search for appointments by patient name (`/appointments/search`).
4. User Authentication – Staff can register (`/auth/register`) and log in (`/auth/login`). Passwords are hashed with bcrypt.
5. Audit Log – All login attempts are stored in `login_audit`, accessible via `/auth/audit`. This logs username, IP address, success status, and timestamp.


---

# Advanced Techniques

1. Password Hashing with bcrypt** – All passwords are stored securely using bcrypt. Example from `auth.js`:

```js
const bcrypt = require('bcrypt');
const saltRounds = 10;
bcrypt.hash("smiths", saltRounds, (err, hash) => console.log(hash));
```

2. Database Connection Pooling – Using `mysql2.createPool` to manage multiple simultaneous connections efficiently in `index.js`:

```js
const db = mysql.createPool({
    host: 'localhost',
    user: 'clinic_app',
    password: 'qwertyuiop',
    database: 'clinic_db',
    connectionLimit: 10
});
global.db = db;
```

3. Audit Logging – Every login attempt is logged with SQL insertions directly in the `/auth/loggedin` route:

```js
db.query(
  "INSERT INTO login_audit (username, success, ip_address) VALUES (?, ?, ?)",
  [username, match, req.ip]
);
```

4. Dynamic Templating – EJS is used to render appointment lists and login pages dynamically with server-side data (`views/appointment_list.ejs`).

---






<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="400" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Clinic Appointment Manager - High-Level Architecture
  </text>
  
  <!-- Client/Browser Layer -->
  <rect x="50" y="60" width="700" height="100" fill="#3498db" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="400" y="90" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Client Layer (Browser)
  </text>
  <text x="400" y="115" font-size="13" text-anchor="middle" fill="white">
    HTML Forms | EJS Templates | CSS Styling
  </text>
  <text x="400" y="140" font-size="12" text-anchor="middle" fill="#ecf0f1">
    User Interface for booking, searching, login, and viewing appointments
  </text>
  
  <!-- Arrow down -->
  <line x1="400" y1="160" x2="400" y2="200" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="420" y="185" font-size="11" fill="#7f8c8d">HTTP/HTTPS</text>
  
  <!-- Application Tier -->
  <rect x="50" y="200" width="700" height="180" fill="#e74c3c" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="400" y="230" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Application Tier (Node.js + Express)
  </text>
  
  <!-- Express Components -->
  <rect x="80" y="250" width="200" height="110" fill="#c0392b" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="180" y="275" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    Express Routes
  </text>
  <text x="180" y="295" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • /appointments/*
  </text>
  <text x="180" y="313" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • /auth/*
  </text>
  <text x="180" y="331" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Route Handlers
  </text>
  <text x="180" y="349" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Session Management
  </text>
  
  <rect x="300" y="250" width="200" height="110" fill="#c0392b" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="400" y="275" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    Business Logic
  </text>
  <text x="400" y="295" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • bcrypt (Password Hashing)
  </text>
  <text x="400" y="313" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Authentication Logic
  </text>
  <text x="400" y="331" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Form Validation
  </text>
  <text x="400" y="349" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Audit Logging
  </text>
  
  <rect x="520" y="250" width="200" height="110" fill="#c0392b" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="620" y="275" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    Template Engine
  </text>
  <text x="620" y="295" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • EJS Rendering
  </text>
  <text x="620" y="313" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Dynamic HTML
  </text>
  <text x="620" y="331" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Server-Side Templates
  </text>
  <text x="620" y="349" font-size="11" text-anchor="middle" fill="#ecf0f1">
    • Data Injection
  </text>
  
  <!-- Arrow down -->
  <line x1="400" y1="380" x2="400" y2="420" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="470" y="405" font-size="11" fill="#7f8c8d">SQL Queries (Pooled)</text>
  
  <!-- Data Tier -->
  <rect x="50" y="420" width="700" height="140" fill="#27ae60" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="400" y="450" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
    Data Tier (MySQL Database)
  </text>
  
  <!-- Database Tables -->
  <rect x="100" y="470" width="170" height="70" fill="#229954" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="185" y="492" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    appointments
  </text>
  <text x="185" y="510" font-size="10" text-anchor="middle" fill="#ecf0f1">
    id, name, email,
  </text>
  <text x="185" y="525" font-size="10" text-anchor="middle" fill="#ecf0f1">
    date, time, created_at
  </text>
  
  <rect x="315" y="470" width="170" height="70" fill="#229954" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="400" y="492" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    users
  </text>
  <text x="400" y="510" font-size="10" text-anchor="middle" fill="#ecf0f1">
    id, username, first, last,
  </text>
  <text x="400" y="525" font-size="10" text-anchor="middle" fill="#ecf0f1">
    email, hashedPassword
  </text>
  
  <rect x="530" y="470" width="170" height="70" fill="#229954" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="615" y="492" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    login_audit
  </text>
  <text x="615" y="510" font-size="10" text-anchor="middle" fill="#ecf0f1">
    id, username, login_time,
  </text>
  <text x="615" y="525" font-size="10" text-anchor="middle" fill="#ecf0f1">
    success, ip_address
  </text>
  
  <!-- Port and Connection Info -->
  <rect x="250" y="160" width="300" height="30" fill="#f39c12" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="400" y="180" font-size="12" font-weight="bold" text-anchor="middle" fill="white">
    Server Running on Port 8000
  </text>
  
  <!-- Connection Pool Info -->
  <rect x="50" y="380" width="150" height="30" fill="#9b59b6" stroke="#2c3e50" stroke-width="1.5" rx="3"/>
  <text x="125" y="400" font-size="11" font-weight="bold" text-anchor="middle" fill="white">
    Connection Pool
  </text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <text x="50" y="580" font-size="11" font-weight="bold" fill="#2c3e50">
    Key Technologies:
  </text>
  <text x="50" y="595" font-size="10" fill="#7f8c8d">
    Node.js | Express.js | EJS | MySQL | bcrypt | Connection Pooling
  </text>
</svg>